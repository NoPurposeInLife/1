openssl s_client -showcerts -connect example.com:443 -servername example.com </dev/null 2>/dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > site-chain.pem
openssl s_client -showcerts -connect example.com:443 -servername example.com </dev/null
sudo cp customCA.crt /usr/local/share/ca-certificates/
sudo update-ca-certificates


# SslForceVersion IS NOT SUPPORTED ANYMORE
sudo tee /etc/apt/apt.conf.d/99forcetls12 >/dev/null <<'EOF'
Acquire::https::CaInfo "/etc/ssl/certs/ca-certificates.crt";
Acquire::https::SslForceVersion "TLSv1.2";
EOF


curl -v --tlsv1.2 --tls-max 1.2 https://google.com


sudo nano /etc/ssl/openssl.cnf
At the bottom, add (or edit existing [system_default_sect]):


[system_default_sect]
MinProtocol = TLSv1.2
MaxProtocol = TLSv1.2
Save and exit, then refresh dynamic configs:


sudo update-ca-certificates


4. Quick test with stunnel (cleanest way without recompiling)

Install stunnel:

sudo apt-get install stunnel4


Create /etc/stunnel/apt-tls12.conf:

# /etc/stunnel/tls12-proxy.conf
pid = /var/run/stunnel-tls12.pid
foreground = no
debug = 2
output = /var/log/stunnel-tls12.log

# global: enforce TLS 1.2 only
# Either of these is fine; use one your stunnel supports:
# 1) explicit single-version:
sslVersion = TLSv1.2
# 2) or use min/max (if supported):
# sslVersionMin = TLSv1.2
# sslVersionMax = TLSv1.2

# service block: act as an HTTP proxy target for local apps
[tls12-proxy]
client = yes
accept = 127.0.0.1:8443
# let stunnel connect to the requested host/port (%h and %p)
connect = %h:%p
; NOTE: %h:%p requires stunnel with this feature enabled (common in recent versions)
; do NOT set an explicit host here â€” we want transparent target forwarding.



Run:

sudo stunnel /etc/stunnel/apt-tls12.conf


Then tell apt to use it:
# nano /etc/apt/apt.conf.d/99forcetls12
Acquire::https::Proxy "http://127.0.0.1:8443/";
